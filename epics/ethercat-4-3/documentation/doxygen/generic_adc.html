<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ethercat: Notes on generic ADC implementation on Ethercat</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Notes on generic ADC implementation on Ethercat </h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment">
* Notes on generic ADC implementation on Ethercat
Ronaldo Mercado
Original: December 2013
Release 4-1: January 2015 Add note that no triggering is available.

The gadc "generic adc" is an asyn port driver that accumulates samples
from the ethercat scanner to provide waveforms and averaged ADC
values.  It was written by James Rowland based on Pete Leicester’s
requirements document for the VME ADCs TDI-CTRL-REQ-015.

* Asyn Parameters for the Generic ADC driver

| Name            | Type       | Use                                                            |
| MODE            | Int32      | gated, trigerred or continuous                                 |
| SAMPLES         | Int32      | number of samples in an acquisition window for continuous mode |
| OFFSET          | Int32      | offset for trigger                                             |
| AVERAGE         | Int32      | number of samples to average for triggered mode                |
| TRIGGER         | Int32      | software trigger                                               |
| BUFFERCOUNT     | Int32      | Samples in the channel's buffer                                |
| VALUE           | Int32      | Averaged value                                                 |
| CAPTURE         | Int32      | unknown                                                        |
| CHANBUFF        | Int32      | unknown                                                        |
| ENABLED         | Int32      | unknonw                                                        |
| RETRIGGER       | Int32      | unknown                                                        |
| CLEAR           | Int32      | unknown                                                        |
| OVERFLOW        | Int32      | unknown                                                        |
| AVERAGEOVERFLOW | Int32      | unknown                                                        |
| STATE           | Int32      | unknown                                                        |
| SUPPORT         | Int32      | unknown                                                        |
| INFO            | Int32      | unknown                                                        |
| PUTSAMPLE       | Int32      | unknown                                                        |
| INTERRUPT       | Int32      | unknown                                                        |
| WAVEFORM        | Int32Array | waveform with samples                                          |

These parameters are accessed using the generic adc template
gadc.template records

* Records in the template gadc.template

| Record Name                         | Record Type | In/Out | Asyn parameter |
|-------------------------------------+-------------+--------+----------------|
| $(DEVICE):ADC$(CHANNEL)_CHANBUFF    | longout     | out    | CHANBUFF       |
| $(DEVICE):ADC$(CHANNEL)_INFO        | longout     | out    | INFO           |
| $(DEVICE):ADC$(CHANNEL)_SAMPLES     | longout     | out    | SAMPLES        |
| $(DEVICE):ADC$(CHANNEL)_OFFSET      | longout     | out    | OFFSET         |
| $(DEVICE):ADC$(CHANNEL)_MODE        | mbbo        | out    | MODE           |
| $(DEVICE):ADC$(CHANNEL)_TRIGGER     | longout     | out    | TRIGGER        |
| $(DEVICE):ADC$(CHANNEL)_CAPTURE     | longout     | out    | CAPTURE        |
| $(DEVICE):ADC$(CHANNEL)_AVERAGE     | longout     | out    | AVERAGE        |
| $(DEVICE):ADC$(CHANNEL)_WAVEFORM    | waveform    | in     | WAVEFORM       |
| $(DEVICE):ADC$(CHANNEL)_BUFFERCOUNT | longin      | in     | BUFFERCOUNT    |
| $(DEVICE):ADC$(CHANNEL)_VALUE       | longin      | in     | VALUE          |
| $(DEVICE):ADC$(CHANNEL)_STATE       | mbbi        | in     | STATE          |
| $(DEVICE):ADC$(CHANNEL)_ENABLED_R   | bi          | in     | ENABLED        |
| $(DEVICE):ADC$(CHANNEL)_ENABLED     | bo          | out    | ENABLED        |
| $(DEVICE):ADC$(CHANNEL)_RETRIGGER   | bo          | out    | RETRIGGER      |
| $(DEVICE):ADC$(CHANNEL)_INTERRUPT   | longout     | out    | INTERRUPT      |
| $(DEVICE):ADC$(CHANNEL)_CLEAR       | longout     | out    | CLEAR          |


The $(DEVICE):ADC1_SAMPLES record sets the driver’s sample count for
whenthe interrupts are generated (MODE set to continuous acquisition
and the VALUE record has to be set to I/O Interrupt). The units are
samples at the driver sampling frequency, 1 KHz.

For example if the $(DEVICE):ADC1_SAMPLES is set to 50, an interrupt is
generated every 50 ms.

ADC1_AVERAGE is the number of samples used for averaging in the gated
of triggered modes (see below). The units are samples at the driver
sampling frequency, 1 KHz.

* Options in AdcControl.edl

The AdcControl.edl screen exposes the driver parameters.

These provide options for gated acquisition and triggered acquisition.

An offset (in samples) can be set, so that the window captured is
offset with the trigger, either before or after the trigger.

The use case during the driver development was the capture of vacuum
events at 100 KHz in front ends. 

This facility is not in use, because triggering is not available.

I haven’t looked at how to generate a trigger from hardware (the VME
equivalent ADCs have physical connectors in the front of the carrier).

* Waveform capture in continous acquisition

For continuous acquisition, the ADC1_SAMPLES record controls how
frequent the updates are and if one wishes to acquire complete
waveforms.

The number of elements in the ADC1_WAVEFORM record has to match to
allow the capture of contiguous data.



</pre></div> </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Fri May 1 2015 18:16:55 for ethercat by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
